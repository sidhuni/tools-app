# Use the Bitnami Legacy repository
image:
  repository: bitnamilegacy/elasticsearch
  tag: 7.17.10  # Or 8.5.1 if available in legacy
  pullPolicy: IfNotPresent

# Critical: Bitnami images run as user 1001 (non-root)
podSecurityContext:
  fsGroup: 1001
containerSecurityContext:
  runAsUser: 1001

# Resource management
resources:
  requests:
    cpu: "500m"
    memory: "1Gi"
  limits:
    cpu: "1000m"
    memory: "2Gi"

# Java Heap settings
esJavaOpts: "-Xmx1g -Xms1g"

# Init container fix (using Busybox because it's tiny and avoids timeouts)
sysctl:
  enabled: true
  image:
    repository: public.ecr.aws/docker/library/busybox
    tag: latest
  command:
    - /bin/sh
    - -c
    - sysctl -w vm.max_map_count=262144
  securityContext:
    privileged: true
    runAsUser: 0

persistence:
  enabled: false