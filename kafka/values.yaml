# In: https://github.com/sidhuni/tools-app.git/kafka/values.yaml

# --- Bitnami Kafka Chart Overrides ---

auth:
  enabled: false

listeners:
  client:
    protocol: PLAINTEXT

# Use legacy images due to Bitnami's repository migration
image:
  repository: bitnamilegacy/kafka

defaultInitContainers:
  prepareConfig:
    image:
      repository: bitnamilegacy/kafka

# Ensure the controller starts up fast for local Rancher Desktop testing
controller:
  replicaCount: 1

# Provide basic resource limits to prevent pod failure on small clusters
resources:
  requests:
    memory: "512Mi"
    cpu: "250m"
  limits:
    memory: "1024Mi"
    cpu: "500m"

# =================================================================
# === FINAL FIXES FOR ARGOCD STABILITY (MUST BE ADDED) ===
# =================================================================

# 1. Instruct the Helm Chart to use the secrets we created manually.
#    (These need to be created via kubectl first, see Step 2)
kraft:
  clusterIdSecret: my-kafka-cluster-kraft

sasl:
  interBrokerSecret: my-kafka-cluster-user-passwords
  controllerSecret: my-kafka-cluster-user-passwords

# 2. Add the Helm Resource Policy Annotation (The Sync Fix)
commonAnnotations:
  # This annotation tells Helm: "Do not touch the resource once created."
  # This prevents the checksum/data differences from causing the Out of Sync state.
  "helm.sh/resource-policy": keep