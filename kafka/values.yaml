auth:
  # Disables SASL/TLS authentication for simple local (in-cluster) use
  enabled: false

listeners:
  client:
    # Sets the protocol to unsecured plaintext (standard for local dev)
    protocol: PLAINTEXT

# --- Image Configuration (Fixes ImagePullBackOff) ---
# Use the legacy image repository due to Bitnami's recent migration
image:
  repository: bitnamilegacy/kafka
  # (Tag defaults to the chart's compatible version, e.g., 4.0.0)

defaultInitContainers:
  prepareConfig:
    image:
      repository: bitnamilegacy/kafka

# --- Local Sizing and Resources ---
controller:
  # Use a single controller/broker for efficiency on Rancher Desktop (KRaft mode)
  replicaCount: 1

resources:
  # Set reasonable limits for Rancher Desktop to prevent cluster instability
  requests:
    memory: "512Mi"
    cpu: "250m"
  limits:
    memory: "1024Mi"
    cpu: "500m"

# =================================================================
# 2. ARGOCD GITOPS STABILITY FIXES
# (Crucial for preventing perpetual Out-of-Sync status)
# =================================================================

# --- KRaft ID Stabilization ---
# Instructs the Helm chart to look for an existing Secret containing the stable 
# Cluster ID instead of auto-generating a new one on every reconciliation.
# NOTE: The secret 'my-kafka-cluster-kraft' MUST be created via kubectl first.
kraft:
  clusterIdSecret: my-kafka-cluster-kraft

# --- Helm Resource Policy Override ---
# This is the definitive fix for stabilizing checksums and auto-generated data.
# It tells Helm to deploy the resource once and then stop managing it for updates.
commonAnnotations:
  "helm.sh/resource-policy": keep